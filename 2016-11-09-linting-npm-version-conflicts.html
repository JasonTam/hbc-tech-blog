<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Linting NPM Version Conflicts</title><title>Linting NPM Version Conflicts | HBC Tech</title><meta property="og:title" content="Linting NPM Version Conflicts"><meta name="author" content="Andrew Powell"><meta property="og:locale" content="en_US"><meta name="description" content="Say you had the need for shared front-end assets (scripts, stylesheets, images, etc.) and a need for an entire org to access them, independently, for reliable builds of many different apps which used those assets. NPM might be a good choice - With NPM’s move to a flat-ish install tree, it’s still a relevant choice. But what about package version conflicts?"><meta property="og:description" content="Say you had the need for shared front-end assets (scripts, stylesheets, images, etc.) and a need for an entire org to access them, independently, for reliable builds of many different apps which used those assets. NPM might be a good choice - With NPM’s move to a flat-ish install tree, it’s still a relevant choice. But what about package version conflicts?"><link rel="canonical" href="https://saksdirect.github.io/hbc-tech-blog/2016-11-09-linting-npm-version-conflicts.html"><meta property="og:url" content="https://saksdirect.github.io/hbc-tech-blog/2016-11-09-linting-npm-version-conflicts.html"><meta property="og:site_name" content="HBC Tech"><meta property="og:type" content="article"><meta property="article:published_time" content="2016-11-09T00:00:00-05:00"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@"><meta name="twitter:creator" content="@Andrew Powell"><script type="application/ld+json">{"name":null,"description":"Say you had the need for shared front-end assets (scripts, stylesheets, images, etc.) and a need for an entire org to access them, independently, for reliable builds of many different apps which used those assets. NPM might be a good choice - With NPM’s move to a flat-ish install tree, it’s still a relevant choice. But what about package version conflicts?","author":{"@type":"Person","name":"Andrew Powell"},"@type":"BlogPosting","url":"https://saksdirect.github.io/hbc-tech-blog/2016-11-09-linting-npm-version-conflicts.html","publisher":null,"image":null,"headline":"Linting NPM Version Conflicts","dateModified":"2016-11-09T00:00:00-05:00","datePublished":"2016-11-09T00:00:00-05:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"https://saksdirect.github.io/hbc-tech-blog/2016-11-09-linting-npm-version-conflicts.html"},"@context":"http://schema.org"}</script><link rel="stylesheet" href="https://saksdirect.github.io/hbc-tech-blog/assets/css/main.css"><link rel="canonical" href="https://saksdirect.github.io/hbc-tech-blog/2016-11-09-linting-npm-version-conflicts.html"><link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,700" rel="stylesheet"><link rel="shortcut icon" href="https://saksdirect.github.io/hbc-tech-blog/assets/images/favicon.ico"></head><body aria-label="Content"><header id="site-header" class="site-header--sub-page"><a class="site-header__logo" href="https://saksdirect.github.io/hbc-tech-blog/"><svg class="hbc-tech-logo" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 64 52"><use class="hbc-tech-logo__text" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#hbc-tech-logo"></use></svg></a><p class="sticky-nav-meta"><a href="https://saksdirect.github.io/hbc-tech-blog/category/front-end" class="meta__category">front end</a> <span class="slug-divider"></span> <span class="meta__title">Linting NPM Version Conflicts</span></p><nav id="menu" class="navigation"><svg class="navigation__menu-icon" xmlns="http://www.w3.org/2000/svg"><path class="bar bar__top" d="M0,3 L30,3"></path><path class="bar bar__cross-1" d="M0,14 L30,14"></path><path class="bar bar__cross-2" d="M0,14 L30,14"></path><path class="bar bar__bottom" d="M0,25 L30,25"></path></svg><menu class="menu"><ul class="link-list"><li class="link-list__link-item"><a href="https://saksdirect.github.io/hbc-tech-blog/" class="link-list__link"><span class="link-list__link-highlight">Insights</span></a></li><li class="link-list__link-item"><a href="https://saksdirect.github.io/hbc-tech-blog/code" class="link-list__link"><span class="link-list__link-highlight">Code</span></a></li><li class="link-list__link-item"><a href="https://saksdirect.github.io/hbc-tech-blog/about" class="link-list__link"><span class="link-list__link-highlight">About</span></a></li><li class="link-list__link-item"><a href="https://saksdirect.github.io/hbc-tech-blog/work-here" class="link-list__link"><span class="link-list__link-highlight">Work Here</span></a></li></ul></menu></nav><search id="header-search" class="header-search"><form class="header-search__form"><input type="text" class="header-search__input" id="header-search-input" placeholder="Search" name="query"></form><svg id="header-search__toggle" class="header-search__svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 64 52"><use class="header-search__icon" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#search"></use></svg><section class="header-search__results" id="header-search__results"></section></search></header><section class="content"><article class="article"><header class="article__header article__header--reveal"><h1 class="header-title" title="Linting NPM Version Conflicts">Linting NPM Version Conflicts</h1><div class="article-meta"><a href="https://saksdirect.github.io/hbc-tech-blog/category/front-end" class="article-meta__category">front end</a> <span class="article-meta__date">NOV 9, 2016</span></div></header><section class="article__content article__content--reveal"><div class="article__content__read-time"><span class="read-time" title="Estimated read time"><span class="read-time__text-1">4 min</span> <span class="read-time__text-2">Read</span> <span class="read-time__text-3">Time</span></span></div><div class="article__content__share-buttons"><ul class="share-buttons"><li class="share-buttons__link-item"><a href="https://twitter.com/intent/tweet?text=https://saksdirect.github.io/hbc-tech-blog//2016-11-09-linting-npm-version-conflicts.html" class="share-buttons__link" title="Share on Twitter"><svg class="hbc-svg-icon" height="36" width="36" xmlns="http://www.w3.org/2000/svg"><use class="hbc-svg-icon--twitter" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#twitter"></use></svg></a></li><li class="share-buttons__link-item"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://saksdirect.github.io/hbc-tech-blog/&source=/2016-11-09-linting-npm-version-conflicts.html&title=Linting NPM Version Conflicts" class="share-buttons__link" title="Share on Linkedin"><svg height="36" width="36" xmlns="http://www.w3.org/2000/svg"><use class="hbc-svg-icon" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#linkedin"></use></svg></a></li><li class="share-buttons__link-item"><a href="https://www.facebook.com/sharer/sharer.php?u=https://saksdirect.github.io/hbc-tech-blog//2016-11-09-linting-npm-version-conflicts.html" class="share-buttons__link" title="Share on Facebook"><svg height="36" width="36" xmlns="http://www.w3.org/2000/svg"><use class="hbc-svg-icon" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#facebook"></use></svg></a></li><li class="share-buttons__link-item"><a href="https://www.reddit.com/submit?url=https://saksdirect.github.io/hbc-tech-blog//2016-11-09-linting-npm-version-conflicts.html" class="share-buttons__link" title="Share on Reddit"><svg height="36" width="36" xmlns="http://www.w3.org/2000/svg"><use class="hbc-svg-icon" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#reddit"></use></svg></a></li></ul></div><div class="article__content__body"><p>Say you had the need for shared front-end assets (scripts, stylesheets, images, etc.) and a need for an entire org to access them, independently, for reliable builds of many different apps which used those assets. NPM might be a good choice - With NPM’s move to a <a href="https://docs.npmjs.com/how-npm-works/npm3">flat-ish install tree</a>, it’s still a relevant choice. But what about package version conflicts?</p><p>At Gilt, the choice was made years ago; before Bower, JSPM, and the host of other package managers came to be. NPM was the logical choice then. And we’re still using it.</p><h2 id="tooling">Tooling</h2><p>Traditionally hard. With the nested NPM installs of yesteryear it was compounded. Not only did we have to detect and move around scripts and other assets from within module packages, we also had to check versions against one another. That was essential in building the final script bundles and combining css for a production deployment.</p><h3 id="the-scenario">The Scenario</h3><p>Let’s say that fictitious <code class="highlighter-rouge">module-a</code> depends on <code class="highlighter-rouge">module-b</code> and <code class="highlighter-rouge">module-util</code>. And that <code class="highlighter-rouge">module-b</code> also depends on <code class="highlighter-rouge">module-util</code>. That’s a pretty straightforward tree and the bundle for the scripts of that tree should be easy. You’d think. But consider that scenario if <code class="highlighter-rouge">module-a</code> depends on <code class="highlighter-rouge">module-util@1.0.0</code> and <code class="highlighter-rouge">module-b</code> depends on <code class="highlighter-rouge">module-util@0.5.0</code>. Now we’ve got a conflict, and that could totally hose our production bundle.</p><h3 id="the-trees">The Trees</h3><p>In prior versions of NPM, the <code class="highlighter-rouge">npm install</code> tree would look like this:</p><div class="highlighter-rouge"><pre class="highlight"><code>node_modules
  module-a
    node_modules
      module-util@1.0.0
      module-b
        node_modules
          module-util@0.5.0
</code></pre></div><p>In today’s NPM it looks like this:</p><div class="highlighter-rouge"><pre class="highlight"><code>node_modules
  module-a
  module-util@1.0.0
  module-b
    node_modules
      module-util@0.5.0
</code></pre></div><p>NPM is quarantining outlier versions of shared modules so that everything plays nicely in a Node.js environment. That’s cool for Node, but not for us… using this as a front-end assets package manager.</p><h3 id="a-solution">A Solution?</h3><p>What we ended up doing was installing the entire package tree to a temporary directory, and then polling every package.json in that directory, building a dependency tree and looking through the tree for conflicts. It worked. It wasn’t a bad method, and it’s one that we duplicated in three generations of tooling.</p><h2 id="a-better-solution">A Better Solution</h2><p>That’s a heck of a lot of work to perform after we make NPM do a heck of a lot of work. There’s a better, faster way. Using NPM’s ability to pull metadata quickly for modules, we can leverage Node 7’s async/await capabilities to produce some elegant code that quickly retrieves and maps an NPM module’s version dependency tree.</p><script src="https://gist.github.com/shellscape/c262ec5d74811525b1fe8c7e26a2c7e1.js"></script><p>Running that script for <code class="highlighter-rouge">koa</code>, we get:</p><div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">...</span>
<span class="nl">koa</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span> <span class="na">version</span><span class="p">:</span> <span class="s1">'1.2.4'</span><span class="p">,</span> <span class="na">parent</span><span class="p">:</span> <span class="s1">''</span> <span class="p">}</span> <span class="p">],</span>
  <span class="s1">'koa-compose'</span><span class="err">:</span> <span class="p">[</span> <span class="p">{</span> <span class="na">version</span><span class="p">:</span> <span class="s1">'2.5.1'</span><span class="p">,</span> <span class="na">parent</span><span class="p">:</span> <span class="s1">'koa'</span> <span class="p">}</span> <span class="p">],</span>
  <span class="s1">'koa-is-json'</span><span class="err">:</span> <span class="p">[</span> <span class="p">{</span> <span class="na">version</span><span class="p">:</span> <span class="s1">'1.0.0'</span><span class="p">,</span> <span class="na">parent</span><span class="p">:</span> <span class="s1">'koa'</span> <span class="p">}</span> <span class="p">],</span>
  <span class="s1">'media-typer'</span><span class="err">:</span> <span class="p">[</span> <span class="p">{</span> <span class="na">version</span><span class="p">:</span> <span class="s1">'0.3.0'</span><span class="p">,</span> <span class="na">parent</span><span class="p">:</span> <span class="s1">'type-is'</span> <span class="p">}</span> <span class="p">],</span>
  <span class="s1">'mime-db'</span><span class="err">:</span>
   <span class="p">[</span> <span class="p">{</span> <span class="na">version</span><span class="p">:</span> <span class="s1">'1.24.0'</span><span class="p">,</span> <span class="na">parent</span><span class="p">:</span> <span class="s1">'mime-types'</span> <span class="p">},</span>
     <span class="p">{</span> <span class="na">version</span><span class="p">:</span> <span class="s1">'1.24.0'</span><span class="p">,</span> <span class="na">parent</span><span class="p">:</span> <span class="s1">'mime-types'</span> <span class="p">},</span>
     <span class="p">{</span> <span class="na">version</span><span class="p">:</span> <span class="s1">'1.24.0'</span><span class="p">,</span> <span class="na">parent</span><span class="p">:</span> <span class="s1">'mime-types'</span> <span class="p">}</span> <span class="p">],</span>
<span class="p">...</span>
</code></pre></div><p>In which we can clearly see that there are no version conflicts. That’s a snippet of the much larger tree returned, but the result is the same. Running that script on our fictitious <code class="highlighter-rouge">module-a</code>, the result would look like:</p><div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="s1">'module-b'</span><span class="err">:</span> <span class="p">[</span> <span class="p">{</span> <span class="na">version</span><span class="p">:</span> <span class="s1">'0.0.1'</span><span class="p">,</span> <span class="na">parent</span><span class="p">:</span> <span class="s1">'module-a'</span> <span class="p">}</span> <span class="p">]</span>
  <span class="s1">'module-util'</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">version</span><span class="p">:</span> <span class="s1">'1.0.0'</span><span class="p">,</span> <span class="na">parent</span><span class="p">:</span> <span class="s1">'module-a'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">version</span><span class="p">:</span> <span class="s1">'0.5.0'</span><span class="p">,</span> <span class="na">parent</span><span class="p">:</span> <span class="s1">'module-b'</span> <span class="p">},</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div><p>And our conflict is visible.</p><h2 id="robustednesseses">Robustednesseses</h2><p>While interesting, this isn’t inherently useful by itself. Moving forward, we’ll be wrapping this into a <a href="http://gulpjs.com">Gulp</a> plugin with proper reporting output and blocking, and run from the local <code class="highlighter-rouge">package.json</code> file.</p><h3 id="cheers">Cheers!</h3><p><em>Originally published at <a href="http://shellscape.org/2016/11/09/linting-npm-version-conflicts">shellscape.org</a> on November 9, 2016.</em></p></div><footer class="article__content__footer"><div class="article-tags"><span class="article-tags__tag">npm</span><span>,</span> <span class="article-tags__tag">node.js</span><span>,</span> <span class="article-tags__tag">open source</span></div><section class="author-bio"><svg class="author__avatar" height="36" width="36" xmlns="http://www.w3.org/2000/svg"><use class="hbc-svg-icon hbc-svg-icon--avatar__circle" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#circle"></use><use class="hbc-svg-icon hbc-svg-icon--avatar__head" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#head"></use><use class="hbc-svg-icon hbc-svg-icon--avatar__body" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#body"></use></svg><span class="author__name">Andrew Powell</span></section></footer></section><aside class="recirc"><h2 class="header__title">Recent Insights</h2><span class="slug-divider"></span> <a class="header__view-all-link" href="https://saksdirect.github.io/hbc-tech-blog/categories/index.html">See All</a><div class="recirc__articles"><article class="recirc__articles__item"><section class="snippet"><h1 class="snippet__title"><a href="https://saksdirect.github.io/hbc-tech-blog/2016-11-16-increasing-build-iq-travis-ci.html" class="snippet__title__link" title="Increasing Build IQ with Travis CI">Increasing Build IQ with Travis CI</a></h1><div class="snippet__meta"><a class="meta__category-link" href="https://saksdirect.github.io/hbc-tech-blog/category/front-end">front end</a> <span class="slug-divider"></span> <span class="meta__author">Andrew Powell</span> <span class="slug-divider"></span> <span class="meta__date">NOV 16, 2016</span></div><a href="https://saksdirect.github.io/hbc-tech-blog/2016-11-16-increasing-build-iq-travis-ci.html" class="snippet__excerpt__link" title="Increasing Build IQ with Travis CI"><p class="snippet__excerpt">Continuous Integration is a must these days. And for social, open source projects it’s crucial. Our tool of choice for automated testing is Travis CI. Like most tools, Travis does what it does well. Unfortunately it’s not very “smart”. Heaven help you if you have a large or modular project with a multitude of tests - you’ll be waiting an eternity between builds.</p></a></section></article><article class="recirc__articles__item"><section class="snippet"><h1 class="snippet__title"><a href="https://saksdirect.github.io/hbc-tech-blog/2016-11-04-running-with-koa-vuejs.html" class="snippet__title__link" title="Running with Scissors: Koa2 and Vue.js">Running with Scissors: Koa2 and Vue.js</a></h1><div class="snippet__meta"><a class="meta__category-link" href="https://saksdirect.github.io/hbc-tech-blog/category/front-end">front end</a> <span class="slug-divider"></span> <span class="meta__author">Andrew Powell</span> <span class="slug-divider"></span> <span class="meta__date">NOV 4, 2016</span></div><a href="https://saksdirect.github.io/hbc-tech-blog/2016-11-04-running-with-koa-vuejs.html" class="snippet__excerpt__link" title="Running with Scissors: Koa2 and Vue.js"><p class="snippet__excerpt">We love Koa at Gilt. (Hell, I love Koa.) Embarking on a new project, I wanted to try something that wasn’t React or Angular. After poking at the alternatives I landed on Vue.js. I picked up the sharpest pair of scissors I could find and started running.</p></a></section></article><article class="recirc__articles__item"><section class="snippet"><h1 class="snippet__title"><a href="https://saksdirect.github.io/hbc-tech-blog/2016-02-15-gulp-scan-find-strings.html" class="snippet__title__link" title="gulp-scan &bull; Find Yourself Some Strings">gulp-scan &bull; Find Yourself Some Strings</a></h1><div class="snippet__meta"><a class="meta__category-link" href="https://saksdirect.github.io/hbc-tech-blog/category/front-end">front end</a> <span class="slug-divider"></span> <span class="meta__author">Andrew Powell</span> <span class="slug-divider"></span> <span class="meta__date">FEB 15, 2016</span></div><a href="https://saksdirect.github.io/hbc-tech-blog/2016-02-15-gulp-scan-find-strings.html" class="snippet__excerpt__link" title="gulp-scan &bull; Find Yourself Some Strings"><p class="snippet__excerpt">We recently ran across the need to simply scan a file for a particular term during one of our build processes. Surpringly enough, we didn’t find a Gulp plugin that performed only that one simple task. And so gulp-scan was born and now resides on npmjs.org.</p></a></section></article><article class="recirc__articles__item"><section class="snippet"><h1 class="snippet__title"><a href="https://saksdirect.github.io/hbc-tech-blog/2015-08-03-gilt-private-npm-modules-npmjsorg.html" class="snippet__title__link" title="Private NPM Modules&#58; A Song of Fire and Ice">Private NPM Modules&#58; A Song of Fire and Ice</a></h1><div class="snippet__meta"><a class="meta__category-link" href="https://saksdirect.github.io/hbc-tech-blog/category/front-end">front end</a> <span class="slug-divider"></span> <span class="meta__author">Andrew Powell</span> <span class="slug-divider"></span> <span class="meta__date">AUG 3, 2015</span></div><a href="https://saksdirect.github.io/hbc-tech-blog/2015-08-03-gilt-private-npm-modules-npmjsorg.html" class="snippet__excerpt__link" title="Private NPM Modules&#58; A Song of Fire and Ice"><p class="snippet__excerpt">Grab a coffee or pop and a snack, this is a read.</p></a></section></article></div></aside></article></section><footer class="footer"><svg class="est1670" xmlns="http://www.w3.org/2000/svg"><use class="hbc-tech-logo__use" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#est1670"></use></svg><section class="footer__links"><ul class="social-links social-links__list"><li class="social-links__list-item"><a class="social-links__link" rel="next" href="#"><svg class="social-links__icon" xmlns="http://www.w3.org/2000/svg"><use class="linkedin" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#linkedin"></use></svg></a></li><li class="social-links__list-item"><a class="social-links__link" rel="next" href="#"><svg class="social-links__icon" xmlns="http://www.w3.org/2000/svg"><use class="twitter" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#twitter"></use></svg></a></li><li class="social-links__list-item"><a class="social-links__link" rel="next" href="#"><svg class="social-links__icon" xmlns="http://www.w3.org/2000/svg"><use class="instagram" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#instagram"></use></svg></a></li></ul><p class="copyright">&copy; 2017 HBC Tech</p></section></footer><script type="text/javascript" src="https://saksdirect.github.io/hbc-tech-blog/assets/js/vendor/scrollmagic/ScrollMagic.min.js"></script><script type="text/javascript" src="https://saksdirect.github.io/hbc-tech-blog/assets/js/vendor/jekyll-search-js/fetch.js"></script><script type="text/javascript" src="https://saksdirect.github.io/hbc-tech-blog/assets/js/vendor/jekyll-search-js/search.js"></script><script type="text/javascript" src="https://saksdirect.github.io/hbc-tech-blog/assets/js/main.js"></script></body></html>